<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Daily Guidance</title>

<style>
:root{
  --bg: #f5eee8;
  --card-w: clamp(230px, 70vw, 440px);
  --overlap-factor: 0.70;
}

html,body{
  height:100%;
  margin:0;
  overflow:hidden;   /* prevents outer scroll */
  font-family:"Inter",Inter,Arial,sans-serif;
  background:var(--bg);
}

.app{
  width:100%;
  max-width:640px;
  margin:0 auto;
  height:100%;
  padding:0px 0px;
  display:flex;
  flex-direction:column;
  align-items:center;
  overflow:hidden;
}

.viewport{
  width:100%;
  position:relative;
  display:flex;
  justify-content:center;
  align-items:flex-end;   
  height:auto;           
  min-height:0;
  padding-top:10px;
  padding-bottom:60px;
  padding-left:18px;
  padding-right:18px;
  overflow:visible;
  }

.scroller{
  display:flex;
  width:100%;
  overflow-x:auto;
  overflow-y:visible;
  scroll-snap-type:x mandatory;
  -webkit-overflow-scrolling:touch;
  scrollbar-width:none;
}
.scroller::-webkit-scrollbar{ display:none; }

.track{
  display:flex;
  align-items:flex-end;  /* KEY CHANGE */
  padding-top:40px;
  padding-bottom:35px;      
  overflow:visible;
}

.card{
  flex:0 0 auto;
  width:var(--card-w);
  aspect-ratio:750/1050;
  position:relative;
  scroll-snap-align:center;
  margin-right:calc(var(--card-w) * -1 * var(--overlap-factor));
  margin-top:110px; 
  transform-origin:center;
  transition:transform 300ms ease;
  cursor:pointer;
  perspective:1200px;
}

.card__inner{
  position:relative;
  width:100%;
  height:100%;
  transform-style:preserve-3d;
  transition:transform 700ms cubic-bezier(.2,.9,.25,1);
}

.card.flipped .card__inner{
  transform:rotateY(180deg);
}

.face{
  position:absolute;
  inset:0;
  border-radius:16px;
  overflow:hidden;
  backface-visibility:hidden;
  -webkit-backface-visibility:hidden;
  box-shadow:
  0 6px 12px rgba(0,0,0,0.35),
  0 2px 6px rgba(0,0,0,0.25);
}

  .card.flipped .face{
  box-shadow:
    0 6px 12px rgba(0,0,0,0.4),
    0 2px 6px rgba(0,0,0,0.3);
}

.face img{
  width:100%;
  height:100%;
  object-fit:cover;
}

.face.front{
  transform:rotateY(180deg);
}

.card.center{
  transform:translateY(-33%);
  }

.card.selected{
  transform:translateY(-18px) scale(1.12)!important;
}

.card.blur:not(.flipped){
  opacity:0;
}

.revealPanel{
  margin-top:-30px;
  display:none;
  flex-direction:column;
  align-items:center;
}

.revealPanel .label{
  font-size:18px;
  font-weight:600;
}

.revealPanel .word{
  font-size:22px;
  font-weight:800;
  text-transform:uppercase;
}
</style>
</head>

<body>
<div class="app">

<div class="viewport">
  <div class="scroller" id="scroller">
    <div class="track" id="track"></div>
  </div>
</div>

<div class="revealPanel" id="revealPanel">
  <div class="label">Todayâ€™s Word</div>
  <div class="word" id="revealWord"></div>
</div>

</div>

<script>

/* ---------- SUPABASE IMAGE BASE ---------- */
const BASE_URL = "https://tppyzexttkuvcobbbmaz.supabase.co/storage/v1/object/public/DailyGuidanceCards/";

/* ---------- CARD FILENAMES ---------- */
const CARD_NAMES = [
"PATIENCE","JOURNEY","PRESENT","EXTRAORDINARY","BEGINNING","NATURE",
"CONNECTION","INTUITION","COMPASSION","ENERGY","RESILIENCE",
"PERSONAL_POWER","IMAGINATION","STABILITY","REST","COMMUNITY",
"CELEBRATION","LUCK","RECIPROCITY","RECEIVING","COMMUNICATION",
"REFRAME","SOFTEN","SELF-WORTH","ABUNDANCE","BALANCE","FREEDOM",
"EASE","AUTHENTICITY","FLOW","ACCEPTANCE","NOTICE","BOUNDARIES",
"DETACHMENT","RENEWAL","GRATITUDE","LIMITLESS","COURAGE","JOY",
"INNER_GUIDANCE","CREATIVITY","SURRENDER","RELEASE","LOVE"
];

const BACK_IMAGE = BASE_URL + "CARD-BACKSIDE.png";

/* ---------- BUILD IMAGE URLS ---------- */
const IMAGES = CARD_NAMES.map((name, index) => {
  const number = String(index + 1).padStart(2, "0");
  return BASE_URL + `CARD-${number}_${name}.png`;
});

const track = document.getElementById('track');
const scroller = document.getElementById('scroller');
const revealPanel = document.getElementById('revealPanel');
const revealWord = document.getElementById('revealWord');

/* ---------- CREATE CARDS ---------- */
IMAGES.forEach((src, i)=>{
  const card = document.createElement('div');
  card.className = 'card';
  card.dataset.src = src;

  const inner = document.createElement('div');
  inner.className = 'card__inner';

  const back = document.createElement('div');
  back.className = 'face back';
  back.innerHTML = `<img src="${BACK_IMAGE}" />`;

  const front = document.createElement('div');
  front.className = 'face front';
  front.innerHTML = `<img src="${src}" />`;

  inner.appendChild(back);
  inner.appendChild(front);
  card.appendChild(inner);
  track.appendChild(card);
});

/* ---------- CENTER DETECTION ---------- */
function updateCenter(){
  const scRect = scroller.getBoundingClientRect();
  const centerX = scRect.left + scRect.width/2;
  let closest=null, closestDist=Infinity;

  document.querySelectorAll('.card').forEach(c=>{
    c.classList.remove('center');
    const r = c.getBoundingClientRect();
    const cx = r.left + r.width/2;
    const d = Math.abs(cx - centerX);
    if(d < closestDist){ closestDist = d; closest = c; }
  });

  if(closest) closest.classList.add('center');
}

scroller.addEventListener('scroll', ()=> requestAnimationFrame(updateCenter));

/* ---------- SELECT CENTER CARD ---------- */
scroller.addEventListener('click', ()=>{
  const center = document.querySelector('.card.center');
  if(!center || center.classList.contains('selected')) return;

  center.classList.add('selected','flipped');
  document.querySelectorAll('.card').forEach(c=>{
    if(c !== center) c.classList.add('blur');
  });

  const keyword = extractKeyword(center.dataset.src);
  revealWord.textContent = keyword;
  revealPanel.style.display = "flex";
});

/* ---------- EXTRACT WORD ---------- */
function extractKeyword(url){
  const file = url.split('/').pop().replace('.png','');
  
  // Remove "CARD-XX_" prefix safely
  const namePart = file.replace(/^CARD-\d+_/, '');
  
  return namePart.replace(/_/g,' ');
}

/* ---------- INITIAL ---------- */
window.addEventListener('load', ()=>{
  setTimeout(updateCenter, 120);
});

</script>
</body>
</html>
